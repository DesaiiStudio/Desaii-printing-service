<script>
    let calculatedInfo = "";

    function calculatePrice() {
      const filamentRate = {
        PETG: 2.4,
        PLA: 2,
        ABS: 3,
        "PETG-CF": 2.8
      };
      const selectedFilament = document.getElementById("filament").value;
      const weight = parseFloat(document.getElementById("weight").value) || 0;
      const hours = parseFloat(document.getElementById("hours").value) || 0;
      const minutes = parseFloat(document.getElementById("minutes").value) || 0;

      const totalHours = hours + (minutes / 60);

      const ratePerHour = 10;
      const baseFee = 150;
      const filamentRatePerGram = filamentRate[selectedFilament] || 0;

      const materialCost = weight * filamentRatePerGram;
      const printingCost = totalHours * ratePerHour;
      const calculatedPrice = materialCost + printingCost;

      let adjustedBaseFee = baseFee;
      if (calculatedPrice > 600) {
        const excess = calculatedPrice - 600;
        const reduction = Math.min((excess / 400) * baseFee, baseFee);
        adjustedBaseFee = baseFee - reduction;
      }

      const totalPrice = calculatedPrice + adjustedBaseFee;

      document.getElementById("price").textContent = totalPrice.toFixed(2);

      calculatedInfo = `Filament: ${selectedFilament}\nWeight: ${weight}g\nTime: ${hours}h ${minutes}m\nTotal Price: ${totalPrice.toFixed(2)} THB`;
    }

    function copyQuotation() {
      if (calculatedInfo) {
        navigator.clipboard.writeText(calculatedInfo).then(() => {
          alert("Quotation copied to clipboard!");
        }).catch(err => {
          console.error("Failed to copy: ", err);
        });
      } else {
        alert("Please calculate the price first.");
      }
    }
</script>
